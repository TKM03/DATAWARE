SET LINESIZE 180
SET PAGESIZE 30
SET HEADING ON

ALTER SESSION SET NLS_DATE_FORMAT = 'DD-MON-YYYY';

COLUMN WEEKDAY FORMAT 999,999 HEADING "WEEKDAY ORDERS"
COLUMN WEEKEND FORMAT 999,999 HEADING "WEEKEND ORDERS"
COLUMN WEEKDAY_SALES FORMAT $999,999,999,999 HEADING "WEEKDAY SALES"
COLUMN WEEKEND_SALES FORMAT $999,999,999,999 HEADING "WEEKEND SALES"
COLUMN WEEKDAY_AVERAGE_SALE FORMAT $999.99 HEADING "WEEKDAY AVERAGE SALES"
COLUMN WEEKEND_AVERAGE_SALE FORMAT $999.99 HEADING "WEEKEND AVERAGE SALES"
COLUMN WEEKDAY_PERCENTAGE FORMAT A20 HEADING "WEEKDAY PERCENTAGE"
COLUMN WEEKEND_PERCENTAGE FORMAT A20 HEADING "WEEKEND PERCENTAGE"

TTITLE -
CENTER 'Time-based Analysis : Weekday vs. Weekend Sales Performance From 2020 to 2024' -
SKIP 1 -
RIGHT 'Date: ' _DATE -
SKIP 1 RIGHT 'Page ' -
FORMAT 999 SQL.PNO -
SKIP 2

REPFOOTER SKIP 1 CENTER '---END OF REPORT---'

SELECT
  d.CalYear,
  SUM(CASE WHEN d.Weekday = 'Y' THEN 1 ELSE 0 END) AS WEEKDAY,
  SUM(CASE WHEN d.Weekday = 'N' THEN 1 ELSE 0 END) AS WEEKEND,
  SUM(CASE WHEN d.Weekday = 'Y' THEN o.TotalPrice ELSE 0 END) AS WEEKDAY_SALES,
  SUM(CASE WHEN d.Weekday = 'N' THEN o.TotalPrice ELSE 0 END) AS WEEKEND_SALES,
  SUM(o.TotalPrice) AS TOTAL_SALES,
  AVG(CASE WHEN d.Weekday = 'Y' THEN o.TotalPrice END) AS WEEKDAY_AVERAGE_SALE,
  AVG(CASE WHEN d.Weekday = 'N' THEN o.TotalPrice END) AS WEEKEND_AVERAGE_SALE,
  TO_CHAR(ROUND(SUM(CASE WHEN d.Weekday = 'Y' THEN o.TotalPrice ELSE 0 END) / SUM(o.TotalPrice) * 100, 2), '999.99') || '%' AS WEEKDAY_PERCENTAGE,
  TO_CHAR(ROUND(SUM(CASE WHEN d.Weekday = 'N' THEN o.TotalPrice ELSE 0 END) / SUM(o.TotalPrice) * 100, 2), '999.99') || '%' AS WEEKEND_PERCENTAGE
FROM
  order_FACTS o
  JOIN Date_dim d ON o.DateKey = d.DateKey
WHERE
  d.CalYear BETWEEN 2020 AND 2024
GROUP BY
  d.CalYear
ORDER BY
  d.CalYear ASC;